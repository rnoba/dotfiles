#!/usr/bin/env sh

DISPLAY=${DISPLAY:-:0}
XAUTHORITY=${XAUTHORITY:-$HOME/.Xauthority}
VT=${XDG_VTNR:-1}

Xorg "$DISPLAY" "vt$VT" -auth "$XAUTHORITY" &
X_PID=$!

cleanup() {
    kill "$X_PID" 2>/dev/null
    wait "$X_PID" 2>/dev/null
}
trap cleanup EXIT INT TERM HUP

export DISPLAY
export XAUTHORITY

until xdpyinfo >/dev/null 2>&1; do
    sleep 0.1
done

export XDG_CURRENT_DESKTOP=i3
export XDG_SESSION_DESKTOP=i3
export XDG_SESSION_TYPE=x11
export DESKTOP_SESSION=i3

[ -f "$HOME/.Xresources" ] && xrdb -merge "$HOME/.Xresources"
[ -f "$HOME/.Xmodmap" ]		 && xmodmap "$HOME/.Xmodmap"

exec dbus-run-session i3
